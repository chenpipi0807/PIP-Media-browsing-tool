# 网络配置说明

## 局域网访问配置

### 1. 启动局域网模式
```bash
# 方式一：使用局域网专用命令
npm run dev:lan

# 方式二：分别启动
npm run server
vite --host 0.0.0.0
```

### 2. 访问地址
- **本地访问**: http://localhost:5173
- **局域网访问**: http://10.250.9.82:5173
- **后端API**: http://10.250.9.82:3001

### 3. 防火墙设置
确保Windows防火墙允许端口3001和5173的入站连接：
```powershell
# 允许端口3001（后端API）
netsh advfirewall firewall add rule name="PIP-Media-Backend" dir=in action=allow protocol=TCP localport=3001

# 允许端口5173（前端）
netsh advfirewall firewall add rule name="PIP-Media-Frontend" dir=in action=allow protocol=TCP localport=5173
```

## 内网穿透配置

### 1. 安装 ngrok
1. 访问 https://ngrok.com/ 注册账号
2. 下载 ngrok 客户端
3. 配置认证令牌：
   ```bash
   ngrok config add-authtoken YOUR_AUTHTOKEN
   ```

### 2. 使用内网穿透
```bash
# 启动带内网穿透的完整服务
npm run start:ngrok
```

### 3. 手动启动 ngrok
```bash
# 为后端API创建隧道
ngrok http 3001

# 为前端创建隧道（可选）
ngrok http 5173
```

## 网络架构

```
本地设备 (10.250.9.82)
├── 前端服务 :5173
├── 后端API :3001
└── 媒体文件访问

局域网设备
└── 通过 http://10.250.9.82:5173 访问

外网设备
└── 通过 ngrok 隧道访问
```

## 故障排除

### 1. 局域网无法访问
- 检查防火墙设置
- 确认IP地址是否正确
- 验证服务是否绑定到 0.0.0.0

### 2. 内网穿透失败
- 检查 ngrok 是否正确安装
- 验证认证令牌是否配置
- 确认网络连接正常

### 3. CORS 错误
- 检查 server/index.js 中的 CORS 配置
- 确认访问的域名已添加到允许列表
